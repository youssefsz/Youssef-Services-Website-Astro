---
import ServiceCard from "../ServiceCard.astro";
import { services, MAX_HOMEPAGE_SERVICES } from "../../data/services";
import BlurText from "../animations/BlurText";
import BlurFade from "../animations/BlurFade";

// Show only up to MAX_HOMEPAGE_SERVICES on homepage
const displayedServices = services.slice(0, MAX_HOMEPAGE_SERVICES);
const hasMoreServices = services.length > MAX_HOMEPAGE_SERVICES;
const remainingCount = services.length - MAX_HOMEPAGE_SERVICES;
---

<section class="py-16 relative bg-background" id="services">
    <!-- Section Background -->
    <div class="absolute inset-0 grid-bg opacity-100 pointer-events-none"></div>

    <div class="container-main relative z-10">
        <!-- Section Header - Centered -->
        <div class="text-center mb-12 flex flex-col items-center">
            <BlurFade client:load delay={0} yOffset={20}>
                <div class="number-display mb-4 text-foreground font-bold text-xl border-2 border-border px-4 py-2 bg-background box-shadow-hard inline-block">01</div>
            </BlurFade>

            <h2 class="display-lg mb-6 text-foreground">
                <BlurFade client:load delay={200} yOffset={20}>
                    <span class="block">My</span>
                    <span class="text-outline-hover">
                        <span class="outline-text">Services</span>
                        <span class="filled-text" aria-hidden="true"
                            >Services</span
                        >
                    </span>
                </BlurFade>
            </h2>

            <BlurFade client:load delay={400} yOffset={20}>
                <p class="text-foreground text-lg max-w-2xl mx-auto font-medium">
                    Premium software solutions ready to scale your business.
                    Click any service to learn more.
                </p>
            </BlurFade>
        </div>

        <!-- Services Grid - Modern Adaptive Layout -->
        <noscript>
            <div class="grid gap-8 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 mb-8">
                {displayedServices.map((service) => (
                    <div class="p-6 border rounded-lg">
                        <h3 class="text-xl font-bold mb-2"><a href={service.link}>{service.title}</a></h3>
                        <p class="mb-4">{service.description}</p>
                        <span class="text-sm text-gray-500">{service.category}</span>
                    </div>
                ))}
            </div>
        </noscript>
        <div class="services-grid">
            {
                displayedServices.map((service, index) => (
                    <BlurFade
                        client:load
                        delay={index * 0.1 + 0.2}
                        yOffset={20}
                        className="service-card-wrapper"
                    >
                        <ServiceCard
                            title={service.title}
                            description={service.description}
                            category={service.category}
                            image={service.image}
                            link={service.link}
                            index={index}
                        />
                    </BlurFade>
                ))
            }
        </div>

        <!-- Show All Services Button (only if more than 6 services) -->
        {
            hasMoreServices && (
                <div class="mt-12 text-center flex justify-center">
                    <BlurFade client:load delay={600} yOffset={20}>
                        <a href="/services" class="btn-secondary group">
                            <span>
                                Show All Services
                                <span class="text-accent ml-1">
                                    (+{remainingCount} more)
                                </span>
                            </span>
                            <svg
                                class="w-4 h-4 transform group-hover:translate-x-1 transition-transform"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="square"
                                    stroke-width="2"
                                    d="M17 8l4 4m0 0l-4 4m4-4H3"
                                />
                            </svg>
                        </a>
                    </BlurFade>
                </div>
            )
        }
    </div>
</section>

<style>
    /* 
     * Services Grid - Flexbox for better centering with few items
     * Centers cards when there are 1-2, wraps to multiple rows for more
     */
    .services-grid {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 1.5rem;
    }

    /* Each card has a max-width and grows flexibly */
    .services-grid :global(.service-card-wrapper) {
        flex: 0 1 400px;
        max-width: 450px;
        min-width: min(100%, 320px);
    }

    /* Ensure the card inside fills the wrapper */
    .services-grid :global(.service-card-wrapper > article) {
        height: 100%;
        width: 100%;
    }

    /* On mobile, full width */
    @media (max-width: 640px) {
        .services-grid :global(.service-card-wrapper) {
            flex: 1 1 100%;
            max-width: 100%;
        }
    }
</style>
